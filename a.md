# 模型假设

所有定心镜的前后两侧在地面的投影均与从该定心镜的中心指向整个镜场中心的连线垂直

在计算中近似认为相邻定心镜镜面间相互平行

# 第一问

## 阴影遮挡效率计算

### 镜面坐标系的建立

我们以镜面$i$为例，以镜面中心$O_i$为坐标原点，沿镜面长方向为$X_i$轴，宽方向为$Y_i$轴，垂直镜面方向向上为$Z_i$轴，建立镜面$i$坐标系，如图\ref{j1}所示：

![image-20230907231804739](C:\Users\yuhangmeng\AppData\Roaming\Typora\typora-user-images\image-20230907231804739.png)

定义$H_0$表示镜场坐标系，$\mathbf{V}|_{H_k}$表示向量$\mathbf{V}$在坐标系$H_k$下的坐标表示，$H|_{H_k}$表示点$H$在坐标系$H_k$下的坐标表示。定日镜$i$的镜面中心在$H_0$下的坐标表示为$O_i|_{H_0}=(XgH_i,YgH_i,ZgH_i)$，镜面$i$坐标系$H_i$转换为镜场坐标系$H_0$的转换关系矩阵为$\mathbf{T}_i$，则有：
$$
\mathbf{V}|_{H_0}=\mathbf{T_i}\cdot \mathbf{V}|_{H_i}
$$

$$
H|_{H_0}=\mathbf{T_i}\cdot H|_{H_i}+O_i|_{H_i}
$$

$$
\mathbf{T_i}=\begin{bmatrix}
  -\sin AH_i&-\cos AH_i\cos EH_i  &\cos AH_i\sin EH_i \\
  \cos AH_i&-\sin AH_i\cos EH_i  &\sin AH_i\sin EH_i \\
  0&\sin EH_i  &\cos EH_i
\end{bmatrix}
$$

其中，$EH_i$表示镜面$i$坐标系$Z_i$轴与镜场坐标系$Z$轴夹角，$AH_i$表示镜面$i$坐标系$Y_i$轴在镜场坐标系$XOY$平面投影与$X$轴夹角。如图\ref{i0}所示：

![image-20230908002246934](C:\Users\yuhangmeng\AppData\Roaming\Typora\typora-user-images\image-20230908002246934.png)

在镜场中定日镜的阴影落入另一个定日镜的镜面，或者反射光线照射到另一台定日镜的背面等会造成阴影遮挡损失，记作$S_{shadow}^i$，表示定日镜$i$的阴影遮挡面积，则定日镜$i$的阴影遮挡效率$\eta_{sb}^i$计算如下：
$$
\eta_{sb}^i=1-\frac{S_{shadow}^i}{S_i}
$$
其中，$S_i$表示定日镜$i$的面积。

以镜面A对镜面B的遮挡为例，（见图\ref{AB}）对镜A上任一点$H_1(x_1,y_1,0)|_{H_A}$，我们计算该点经光线照射后是否落在镜面B内，步骤如下：

![image-20230908022022053](C:\Users\yuhangmeng\AppData\Roaming\Typora\typora-user-images\image-20230908022022053.png)

step1

将点$H_1|_{H_A}$坐标由坐标系$H_A$下坐标转换到坐标系$H_0$下坐标：
$$
H_1|_{H_0}=\mathbf{T_A}\cdot H|_{H_A}+O_A|_{H_A}
$$
再将该点转换到坐标系$H_B$下：
$$
H_1|_{H_B}=\mathbf{T_B}^{-1}\cdot (H_1|_{H_0}-O_B|_{H_0})
$$
将经过点$H_1$的光线由坐标系$H_0$转换到坐标系$H_B$：
$$
\mathbf{V}|_{H_B}=\mathbf{T_B}^{-1}\cdot \mathbf{V}|_{H_0}
$$
假设点$H_1$在坐标系$H_B$下坐标为$H_1(x_1',y_1',z_1')|_{H_B}$，光线向量$\mathbf{V}|_{H_B}=(a,b,c)$，计算落在镜面B坐标$H_2(x_2,y_2,0)|_{H_B}$：
$$
\frac{x_2-x_1'}{a}=\frac{y_2-y_1'}{b}=\frac{-z_1'}{c}
$$
判断$H_2$是否落在定日镜B内：
$$
X_{H_2}=\left\{\begin{matrix}
 1,&|x_2|\le 3\ \text{and}\ |y_2|\le 3\\
0,&\text{else}
\end{matrix}\right.
$$
其中，$X_{H_2}=1$表示点$H_2$落在定日镜B内，$X_{H_2}=0$表示点$H_2$没有落在定日镜B内.

由于各定日镜均匀地分布在以吸收塔为圆心的18个不同半径的圆周上，因此，我们只需专注于计算这几类定日镜的阴影遮挡效率。我们利用蒙特卡洛方法来计算这几类定日镜的阴影遮挡效率，伪代码如下：

![image-20230908031433792](C:\Users\yuhangmeng\AppData\Roaming\Typora\typora-user-images\image-20230908031433792.png)

## 余弦效率

太阳入射光线反方向的单位向量$\mathbf{i}$为：
$$
\mathbf{i}=(-\cos \alpha_s\sin\gamma_s,-\cos\alpha_s\cos\alpha_s,-\sin\alpha_s)
$$
太阳光反射向量$\mathbf{R}$为：
$$
\mathbf{R}=(\frac{-x_i}{(x_i^2+y_i^2+(z_0-z_1)^2)^\frac{1}{2}},\frac{-y_i}{(x_i^2+y_i^2+(z_0-z_1)^2)^\frac{1}{2}},\frac{z_0-z_i}{(x_i^2+y_i^2+(z_0-z_1)^2)^\frac{1}{2}})
$$
其中，$\alpha_s$表示太阳的高度角，$\gamma_s$表示太阳的方位角。

又由$\cos2\theta_i=\mathbf{i}\cdot \mathbf{R}$，得到余弦效率的计算公式如下：
$$
\eta_{\cos}=\cos\theta_i=\cos\frac{\arccos \mathbf{i}\cdot\mathbf{R}}{2}
$$

## 太阳光锥模型的建立

太阳光锥模型是一种用于模拟太阳光照射的几何模型。在这个模型中，太阳被视为一个无限远的光源，其发出的光线形成一个锥形。这个锥形的顶点位于定心镜上的某一点，而锥形的底面则是太阳的投影。

在镜面A上随机取点$H_1(x_1,y_1,z_1)|_{H_A}$，以点$H_1$为原点，沿主光线方向朝向太阳圆盘中心为$Z_s$轴，$X_s$轴始终与地面平行，$Y_s$轴垂直于$X_sO_sZ_s$平面，建立太阳光锥坐标系如下：

假设这一束光锥中光线$S_s$与来自太阳中心的主光线的夹角为$\sigma$，与$X_s$轴夹角为$\tau$，则该光线的方向向量为：
$$
\mathbf{S_s}=(\sin \sigma\cos \tau,\sin\sigma\sin\tau,\cos\sigma)
$$
在该坐标系下转换到镜场坐标系$H_0$的旋转矩阵为$\mathbf{T_S}$，以该光锥中光线$S_s$为例，计算该光线经反射后到达吸热器上的落点坐标，计算步骤如下：

step1

将坐标$H_1|_{H_A}$转换到坐标系$H_0$下：
$$
H_1(x_1',y_1',z_1')|_{H_0}=\mathbf{T_A}\cdot H_1|_{H_A}
$$
将该光线由太阳光锥坐标系$H_s$转换到镜场坐标系$H_0$：
$$
\mathbf{S_s}|_{H_0}=\mathbf{T_S}\cdot \mathbf{S_s}|_{H_s}
$$
将坐标系$H_A$法向量转换到坐标系$H_0$下坐标：
$$
\mathbf{OZ_A}|_{H_0}=\mathbf{T_A}\cdot \mathbf{OZ_A}|_{H_A}
$$
计算反射向量$\mathbf{S_s'}=(m,n,l)$：
$$
\frac{\mathbf{S_s}|_{H_0}-\mathbf{S_s'}|_{H_0}}{2}=-\mathbf{OZ_A}|_{H_0}
$$
计算该光线经镜面反射后射向吸收塔的方程：
$$
\frac{x-x'_1}{m}=\frac{y-y_1'}{n}=\frac{z-z_1'}{l}
$$
计算集热器方程$J$：
$$
J=\left\{\begin{matrix}
x^2+y^2=\frac{49}{4} \\
z\in[80,88]
\end{matrix}\right.
$$
设计算法判断该光线是否落入集热器中，我们的算法思路是判断当$z$值由集热器底部变化到集热器顶部时，观测$x^2+y^2$的值是否落入集热器范围内。及：
$$
G(z-4)=x^2+y^2=x_1'^2+y_1'^2+\frac{1}{l^2}(m^2+n^2)(z-4)^2+\frac{2}{l}(ny_1'+mx_1')(z-4)
$$
通过观测二次函数$G(z-4)$观测值的变化，来判断光线是否落入集热器范围内。

我们也使用蒙特卡洛方法计算各定日镜的截断效率，算法伪代码如下：

![image-20230909105206844](C:\Users\yuhangmeng\AppData\Roaming\Typora\typora-user-images\image-20230909105206844.png)

定日镜场的布置优化

DELSOL3型布局考虑规则的径向交错定日镜场(见图\ref{del}），该方式能有效的降低阴影/遮挡效率损失，提高土地利用率和大气衰减效率。考虑定日镜宽为$LH$，定日镜高为$LW$，假设我们有$n$个基本区域，则初始总定日镜数量为$(2^{n+1}-1)\cdot N$，定义安装高度为$RH$，则有：
$$
LH\le RH\le 6
$$

$$
2\le LW\le LH\le 8
$$

定义$DM$表示为镜面中心间距离，$DH$表示为定日镜对角线长度，考虑定日镜间不能发生机械碰撞且相邻镜面中心间距离比镜面宽度多$5m$以上，则有：
$$
DH=\sqrt{LH^2+LW^2}
$$

$$
DM\ge LH+5
$$

我们给定吸收塔位置为镜场坐标系原点，即点$(0,0)$，第一行首个的定日镜中心坐标我们给出为$(100+\frac{DH}{2},0)$，定义基本环为该环$y$轴方向存在定日镜，交错环为该环$y$轴方向不存在定日镜，以一个基本环加上交错环作为一个基本区域，我们首先计算得到第一个行定日镜数目为$N$，则第一个基本区域的定日镜数量为$2N$，由数学知识易得下一区域内各行的定日镜数量为上一个基本区域的定日镜数量的两倍，即该区域内定日镜数量为$4N$，由题目要求可以得到布置区域距吸收塔范围在$[R_{\min},R_{\max}]$之间定义相邻行之间的最小增量为$\Delta R_h$，相邻区域间最小增量为$\Delta R_f$，则有：
$$
\Delta R_h=\frac{\sqrt{3}DM}{2}-R_1+\sqrt{R_1+\frac{DM^2}{4}}
$$

$$
\Delta R_f=DM
$$

接下来我们使用SolarPILOT（Solar Power Tower Integrated Layout and OptimizationTool）软件平台进行仿真模拟，将初始数据导入软件后进行优化，能够得到最大的镜场排布以及较优的镜场额定功率，我们的优化目标为单位镜面面积平均输出热功率最大，而软件优化得到的最优的年平均输出功率大于所要求的额定功率，可以通过减少定日镜数量的方法使得额定功率满足需求，同时为了达到更高的单位镜面面积年平均输出功率，应当首先考虑移除输出功率最低的定日镜。以上能够保证满足约束条件情况下达到较优的镜场布局，该镜场平均光学效率及输出功率见表\ref{s1}，年平均光学效率及输出功率表见表\ref{s2}，设计参数见表\ref{s3}，吸收塔的位置坐标、定日镜尺寸、安装高度、位置坐标保存在 result2.xlsx文件中，详见附件。 

```latex
\begin{longtable}[c]{@{}ccl@{}}
\toprule
序号 & 符号  & 符号说明 \\* \midrule
\endfirsthead
%
\multicolumn{3}{c}%
{{\bfseries 表\thetable (续)}} \\
\toprule
序号 & 符号  & 符号说明 \\* \midrule
\endhead
%
1  & $H_0$ & 镜场坐标系  \\
2  & $H_i$ & 镜面$i$坐标系  \\
3  & $H_s$ & 太阳光锥坐标系  \\
4  & $H|_{H_i}$ & 点$H$在坐标系$H_i$下的坐标表示 \\
5&$\mathbf{V}|_{H_i}$&向量$\mathbf{V}$在坐标系$H_i$下的坐标表示\\
6&$\mathbf{T_i}$&坐标系$H_i$转换到坐标系$H_0$的转换关系矩阵\\ 
7&$\mathbf{T_S}$&从坐标系$H_s$转换到坐标系$H_0$的转换关系矩阵\\ 
8&$O_i$&定心镜$i$中心坐标\\ 
9&$EH_i$&坐标系$H_i$中$Z_i$轴与坐标系$H_0$中$Z$轴夹角\\ 
10&$AH_i$&坐标系$H_i$中$Y_i$轴在镜场坐标系$XOY$平面投影与$X$轴夹角\\ 
11&$\mathbf{i}$&太阳光入射方向的单位向量\\ 
12&$\mathbf{R}$&经平面镜反射向量\\ 
13&$J$&坐标系$H_0$下集热器方程\\ 
14&$\hat{E}$&单位镜面面积输出热功率\\
15&$LH$&定日镜宽高\\ 
16&$LW$&定日镜高度\\ 
17&$RH$&定日镜安装高度\\ 
18&$DM$&定日镜中心间距离\\ 
19&$DH$&定日镜镜面对角线长度\\ 
20&$\Delta R_h$&相邻行间之间的最小增量 \\ 
21&$\Delta R_f$&相邻区域之间的最小增量\\ 
22&$n$&基本区域数量\\
23&$N$&第一行定日镜数量\\ * \bottomrule
\end{longtable}
```

# 模型评价

## 模型检验

在问题一中我们建立模型利用蒙特卡洛算法来模拟阴影遮挡效率以及截断效率，对于随机化算法我们需要判断其是否收敛。在蒙特卡洛模拟中，只有当迭代次数足够多时才会收敛到真实值附近，我们选取的点数量为$3\times 10^4$个点，我们随机选取两个存在阴影遮挡损失的定心镜，画出选取的点的数量与计算的阴影遮挡效率的关系，判断算法是否收敛。同理对于截断效率，我们也随机取两定心镜，其中迭代次数与所求效率值如图\ref{mxjy}:

| 日期 | 平均光学效率 | 平均余弦效率 | 平均阴影遮挡效率 | 平均截断效率 | 单位面积镜面平均输出热功率 (kW/m2) |

| 1 月 21 日 | 0.85 | 0.90 | 0.92 | 0.88 | 450 |

| 2 月 21 日 | 0.82 | 0.88 | 0.91 | 0.85 | 420 |

| 3 月 21 日 | 0.88 | 0.92 | 0.94 | 0.90 | 480 |

| 4 月 21 日 | 0.90 | 0.94 | 0.95 | 0.92 | 500 |

| 5 月 21 日 | 0.92 | 0.95 | 0.96 | 0.94 | 520 |

| 6 月 21 日 | 0.94 | 0.96 | 0.97 | 0.95 | 540 |

| 7 月 21 日 | 0.93 | 0.95 | 0.96 | 0.94 | 530 |

| 8 月 21 日 | 0.91 | 0.94 | 0.95 | 0.93 | 510 |

| 9 月 21 日 | 0.89 | 0.92 | 0.94 | 0.91 | 490 |

| 10 月 21 日 | 0.87 | 0.91 | 0.93 | 0.89 | 470 |

| 11 月 21 日 | 0.84 | 0.89 | 0.92 | 0.86 | 440 |

| 12 月 21 日 | 0.81 | 0.87 | 0.91 | 0.84 | 410 |

(1)

*SolarPILOT | Concentrating Solar Power | NREL*. https://www.nrel.gov/csp/solarpilot-background.html (accessed 2023-09-10).





















本文在优化定日镜场最大平均单位镜面面积输出功率设计中，建立了镜面坐标系、太阳光锥坐标系，并计算得到其与镜场坐标系间的转换关系矩阵，利用随机化模拟方法，计算出了在定日镜场各参数已知的情况下的平均光学效率和输出功率等结果。同时对定日镜场结构进行优化后，利用SolarPILOT软件实现COBYLA算法对定日镜场的输出功率优化，通过移除输出功率较低的定日镜得到在优化后的镜场各参数值使得在达到额定功率情况下单位面积镜面面积年平均输出热功率尽量大。并对本文模型和算法进行了检验和评价。

针对问题一：本文首先建立了镜面坐标系用于余弦效率和阴影遮挡效率的计算中，通过各坐标系间的转换关系矩阵以及入射光、反射光和法线间的数量关系得到余弦角进而计算余弦效率。其次，利用蒙特卡洛模拟方法计算得到了各镜面的阴影遮挡效率。再进一步，建立了太阳光锥坐标系用于求解截断效率，利用蒙特卡洛光际追踪算法，计算得到了各镜面的截断效率。最后，利用题中所给公式得到年平均光学效率及输出功率（见下表）和每月21日的平均光学效率及输出功率（详见表\ref{a2}）。

针对问题二：考虑到镜场布局较为疏松，首先使用DELSOL3布局对定日镜场的布局进行优化，再利用SolarPILOT软件中的COBYLA算法对镜场输出功率进行仿真优化。在这里可优化的镜场参数为定日镜分布情况，定日镜镜面高度、宽度、安装高度以及吸收塔位置，优化后得到在满足约束条件的情况下月平均光学效率、输出功率(详见表\ref{b2})，年平均光学效率、输出功率以及镜场设计参数表(见下表)。















接下来我们使用 SolarPILOT 软件平台进行仿真模拟，布局优化后我们将初始数值在Field Layout界面进行导入并运行。
Step1：在Climate界面选择China CHN Mangnai(INTL).csv，也就是经纬度及海拔最接近题目所给背景的地点作为定日镜场地的模拟地点。
Step2：在Layout Setup界面对定日镜场的设计功率、吸收塔光学高度及场地范围进行约束。
Step3：在Receiver 1界面设置集热器的高度和直径，到此即完成了初始模型的建立。
Step4：在Parametrics界面点击Add选择”Structure height”和”Structure width”，也就是定日镜长度、宽度及高度进行约束及优化，长度宽度的优化范围为[2,8]，高度的优化范围为[2,6]，步长为0.1，运行。
Step5：将运行所得结果导出为csv格式，并对文件中数据进行筛选处理，选择单位镜面面积年平均输出热功率最大的一组数据。
Step6：将所得最优长度宽度及高度在Template 1界面进行输入并运行，然后在Parametrics界面选择相关方位间距因子进行约束优化，优化范围设置为[12.3,20]，步长为0.1，进行优化。
Step7：同Step5，筛选处理并选取定日镜底座中心间距的最优数据。
Step8：在Filed Layout界面对优化后的模型进行运行，得出结论图像，保存相关图像，如下图 ：
Step9：在Performance Simulation界面对60个相应时间点的模型进行运行，得出有关阴影遮挡效率、余弦效率、截断效率及额定输入热功率的数据，最后对所得数据进行处理，即可得出结论。







该问在可以考虑不同定日镜间参数可以不同的情况下，仍先考虑优化定日镜布局。首先考虑定日镜安装高度，增大定日镜安装高度会增大余弦效率、增大阴影遮挡效率，我们仍采用问题二中DELSOL3型布局方式，考虑在区域$k$中的定日镜安装高度为$h_k$，有：
$$
h_k\ge\frac{LW}{2} ,\forall k
$$
则第一个基本区域$h_1$和最后一基本区域定日镜安装高度为$h_n$满足：
$$
2\le h_1\le h_n\le6
$$
对于初始布局，我们可以取各区域安装高度增量$\Delta h$为一定值，并且满足：
$$
2+(k-1)\Delta h\le h_{k}\le6-(n-k)\Delta h
$$
上式使得每个区域的安装高度均不超过下一区域安装高度的最小值，不低于上一区域安装高度的最大值。

在该问中令$n=50$，即将镜场划分为50个不同半径的同心圆环区域，并分别进行区域化的优化，使得满足问题二的约束条件以及安装高度约束的情况下输出单位镜面面积年平均输出热功率。由于在问题二中已经对吸收塔的位置进行了多次迭代优化，所以在问题三中我们使用问题二所得结论，不再对吸收塔位置进行讨论。

## 模型求解

以第一个区域为例，我们将需要优化的镜场参数输入进软件，进行仿真优化和迭代得到如下镜场年平均光学效率分布云图，如图\ref{yt11}所示：